name: claudygod-mobile-dev

services:
  mobile-web:
    profiles: ["web"]
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: claudygod-mobile-web
    environment:
      EXPO_DEVTOOLS_LISTEN_ADDRESS: 0.0.0.0
      EXPO_PUBLIC_API_URL: ${EXPO_PUBLIC_API_URL:-http://localhost:4000}
      EXPO_PUBLIC_MOBILE_API_KEY: ${EXPO_PUBLIC_MOBILE_API_KEY:-dev-mobile-api-key}
      CHOKIDAR_USEPOLLING: "1"
    ports:
      - "19006:19006"
      - "19000:19000"
      - "19001:19001"
    volumes:
      - ./:/app
      - claudygod_mobile_node_modules:/app/node_modules
    restart: unless-stopped

  mobile-expo:
    profiles: ["native"]
    build:
      context: .
      dockerfile: Dockerfile.expo.dev
    container_name: claudygod-mobile-expo
    command: ["yarn", "start:online", "--", "--host", "lan", "--port", "8081"]
    environment:
      EXPO_DEVTOOLS_LISTEN_ADDRESS: 0.0.0.0
      EXPO_PUBLIC_API_URL: ${EXPO_PUBLIC_API_URL:-http://localhost:4000}
      EXPO_PUBLIC_MOBILE_API_KEY: ${EXPO_PUBLIC_MOBILE_API_KEY:-dev-mobile-api-key}
      EXPO_PACKAGER_HOSTNAME: ${EXPO_PACKAGER_HOSTNAME:-}
      CHOKIDAR_USEPOLLING: "1"
    ports:
      - "8081:8081"
      - "19000:19000"
      - "19001:19001"
      - "19002:19002"
      - "19006:19006"
    volumes:
      - ./:/app
      - claudygod_mobile_node_modules:/app/node_modules
    stdin_open: true
    tty: true
    restart: unless-stopped

volumes:
  claudygod_mobile_node_modules:
